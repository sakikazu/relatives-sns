<div class="row">
  <div class="span7 offset2">
    <%= link_to '自分の日記へ', blogs_path, class: "btn" %>
    <%= link_to "#{@blog.user.dispname}の日記一覧を見る", blogs_path(:username => @blog.user.username), class: "btn" if @blog.user != current_user %>
    <%= link_to "編集する", edit_blog_path(@blog), class: "btn btn-info" if editable(current_user, @blog.user) %>
    <%= link_to '削除', @blog, method: :delete, class: "btn btn-danger", data: {confirm: '本当に削除してもよろしいですか？'} if editable(current_user, @blog.user) %>

    <div class="page-header ver2">
      <h3><%= @blog.title %><small><%= link_to "（コメント数：#{@blog.comments.select{|n| n.id.present?}.size}）", "#comments" %></small></h3>
    </div>

    <div class="once_content">
      <div class="info">
        投稿者：<%= link_to @blog.user.dispname, blogs_path(user_id: @blog.user_id) %> | 
        投稿日時：<%= @blog.created_at.to_s(:long) if @blog.created_at %>
      </div>

      <div class="description">
        <div id="blog_images" class="cf">
          <% @blog.blog_images.each do |image| -%>
            <%= link_to image_tag(image.image(:thumb)), image.image(:large), {:class => colorbox_class} if image.image? %>
            <%= link_to "削除", {:action => :destroy_image, :id => image.id}, method: "delete", data: {confirm: "画像を削除してもいいですか？"} if image.image? && editable(current_user, @blog.user) %>
          <% end -%>
        </div>
        <%= "<hr>".html_safe if @blog.blog_images.present? %>
        <p class="text"><%= @blog.content.html_safe %></p>
      </div>
      <div class="nice">
        <span id="update_nice">
          <%= nice_field(@blog, "blog", "#update_nice") %>
        </span>
      </div>
    </div>

    <%= link_to "ページ最下部へ", "#comment_form", class: "btn btn-warning btn-block" if @blog.comments.select{|n| n.id.present?}.size > 5 %>

    <div class="page-header ver2"><h3>コメント</h3></div>
    <div id="comments">
      <%= render :partial => "comments" %>
    </div>

    <div id="comment_form">
      <%= form_for @new_comment, url: create_comment_blog_path(@blog.id), :remote => true do |f| %>
        <%= f.text_area :content, rows: 5, class: "span7", placeholder: "コメントする" %><br />
        <%= f.hidden_field :parent_id %>
        <%= f.hidden_field :parent_type %>
        <div class="form-actions">
        <%= f.submit "投稿する", class: "btn btn-primary" %>
        </div>
      <% end -%>
    </div>
  </div> <!-- .span -->

</div> <!-- .row -->
