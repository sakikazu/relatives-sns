<script>
$(document).ready(function() {

  $.autopager({
    content: '.autopagerize_page_element', // コンテンツ部分のセレクタ 
    //次ページリンクのセレクタ(Default: 'a[rel=next]')
    //link   : '.next_page',  //デフォルトでいいのでコメントアウト 
    load: function(current, next) {
      var pageBreak = '<p>ページ: <a href="' + current.url + '">' + current.page + '</a></p>';
      //thisは読み込んだコンテンツ要素を指す
      $(this).before(pageBreak);
      //読み込んだページに再度colorboxを適用させる
      $(".colorbox").colorbox();
      nice_member();
    }
  });

}); //jquery#ready
</script>

<div id="mutter">
つぶやき総数: <%= @mutters.total_entries %>
<%= will_paginate @mutters, :previous_label=>'&#171;前', :next_label=>'次&#187;', :class => 'flickr_pagination' %>
<br />

<div id="form_search">
  <%= form_tag search_mutters_path, {:method => :get} do %>
    <%= text_field_tag :search_text %>
    <%= hidden_field_tag :action_flg, 1 %>
    <%= submit_tag "発言内容から検索する", :class => "button" %>
  <% end %>
  <%= form_tag search_mutters_path, {:method => :get} do %>
    <%= hidden_field_tag :action_flg, 2 %>
    <%= submit_tag "画像が含まれる", :class => "button" %>
  <% end %>
  <%= form_tag search_mutters_path, {:method => :get} do %>
    <%= hidden_field_tag :action_flg, 3 %>
    <%= submit_tag "URLが含まれる", :class => "button" %>
  <% end %>
</div>


<div class="autopagerize_page_element">
<ul class="mutter_rows">
  <%= render :partial => 'mutter_row', :collection => @mutters %>
</ul>
<%= will_paginate @mutters, :previous_label=>'&#171;前', :next_label=>'次&#187;', :class => 'flickr_pagination' %>
</div> <!-- autopagerize_page_element -->
</div>

<% if @users.present? -%>
  <div class="right_side_bar">
  <% cache :mutter_by_user do %>
    <div id="mutter_by_user">
      <p class="title">メンバー</p>
      ()内はつぶやき数
      <ul>
      <% @users.each do |user| -%>
        <li><%= link_to user.dispname(User::FULLNAME), mutter_by_user_path(user.id) %>(<%= @users_mcnt[user.id] %>)</li>
      <% end -%>
      </ul>
    </div>
  <% end -%>
  </div>
<% end -%>
