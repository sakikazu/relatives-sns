/*
 *  The Footer Plugin
 *  
 * 	Copyright© 2010 Icewares
 *  
 *  Licensed under the CPL (http://www.icewares.com.br/footer/licence.html)
 */
/*
 * 	The Footer Plugin
 *  version 1.0
 *  Created by Stéfano Stypulkowski @ Icewares
 *   
 *  Require jQuery 1.4 http://www.icewares.com.br/footer/
 *  
 *  For instructions see: 
 */

var id = new String();

var height = new Number();

var footerHeight = new Number();

var styleAbsolute = { "position" : "absolute" , "bottom" : "0" , "z-index" : "200"};

var styleRelative = { "position" : "relative" , "bottom" : "auto" };

var config;

var footerObject;

var browserAdjust = 0;

(function(j$){
	
	j$.fn.footer = function(options) {
		
		var defaults = {
			"monitorTimeOut" : 200
		};
		
		config = j$.extend(defaults, options);
		
		if ( config.monitorTimeOut < 1 ){
			config.monitorTimeOut = 1;
		}
		
		if ( j$(this).attr("id") == "" ){
			j$(this).attr("id", "footerAutoGeneratedId");
		}
		
		id = "#" + j$(this).attr("id");

		height = j$(document).height();
		
		footerHeight = j$(id).height();
		
		if ( j$.browser.msie ){
			browserAdjust = 4;
		}
		
		setPosition();
		
		monitor();
	}
})(jQuery);


function monitor(){
	
	if ( height != j$(document).height() ){
		
		setPosition();
		
		height = j$(document).height();
	}
	
	if ( footerHeight != j$(id).height() ){
		
		setFsmHeight();
		
		footerHeight = j$(id).height();
	}
	
	setTimeout('monitor()', config.monitorTimeOut);
}

function setPosition(){
	
	if ( (j$(document).height() - browserAdjust) > j$(window).height() ){
	
		j$("#footerSpaceManager").remove();
		
		j$(id).css(styleRelative);
		
	}else{
		
		if ( j$("#footerSpaceManager").size() == 0 ){
			
			j$("body").append("<div id='footerSpaceManager' style='height: " + j$(id).height() + "px;'></div>")
		}
		
		j$(id).css(styleAbsolute);
	}
}

function setFsmHeight(){

	if ( j$("#footerSpaceManager").size() > 0 && j$(id).height() != j$("#footerSpaceManager").height() ){
		
		j$("#footerSpaceManager").height(j$(id).height());
	}
}
