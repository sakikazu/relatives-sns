<script>
$(document).ready(function() {
  $("#mokuji")
    .append('<ul><h3 class="normal">目次</h3></ul>')
  
  var items = [];
  $('h2').each(function(idx){
    $(this).attr("id", "mokuji"+idx);
    items.push('<a href="#mokuji' + idx + '">' + $(this).text() + '</a>');
  });
  $("#mokuji ul").append('<li>' + items.join("</li><li>") + '</li>');
  })
</script>

<div id="nice_show">
<div class="select_menu clearfix">
  <%= link_to "<span>最近</span>".html_safe, recent_nices_path %>
  <%= link_to "<span class='selected'>ランキング</span>".html_safe, ranking_nices_path %>
</div>

<div id="mokuji"></div>
<h2 class="normal">人気のつぶやき</h2>
<% @mutter_data.each_with_index do |data, idx| -%>
  <div class="nice_rank"><%= idx + 1 %>位：<%= data[:count] %> イイネ</div>
  <% obj = Mutter.find_by_id(data[:id]) -%>
  <% if obj.present? -%>
    <div class="nice_content">
      <div class="mutter_rows" style="margin-left:10px">
        <b style="font-size:14px"><%= link_to '(詳細)', mutter_path(:id => obj.id) %></b><br>
        <span class="image"><%= link_to(image_tag(obj.image(:thumb)), obj.image(:large), {:class => colorbox_class}) if obj.image?  %></span>
        <span class="content" style="background:#E7E7DA;padding:5px;font-weight:bold"><%= br auto_link(obj.content) %></span>
        <div class="clear"></div>
        <%= nice_author_and_created_at(obj) %>
      </div>
    </div>
    <div class="nice_user">
      イイネした人：
      <% obj.nices.each do |nice| -%>
        <%= nice.user.dispname %> /
      <% end -%>
    </div>
  <% else -%>
    削除されました.
  <% end -%>
  <hr>
<% end -%>

<h2 class="normal">人気の写真</h2>
<% @photo_data.each_with_index do |data, idx| -%>
  <div class="nice_rank"><%= idx + 1 %>位：<%= data[:count] %> イイネ</div>
  <% obj = AlbumPhoto.find_by_id(data[:id]) -%>
  <% if obj.present? -%>
    <%= link_to(image_tag(obj.attach(:thumb)), slideshow_album_photo_path(obj), {:class => colorbox_fix_size}) if obj.attach?  %><br>
    写真タイトル：<%= obj.title %> / アルバム：<%= link_to obj.album.title, obj.album %>

    <div class="nice_user">
      イイネした人：
      <% obj.nices.each do |nice| -%>
        <%= nice.user.dispname %> /
      <% end -%>
    </div>
  <% else -%>
    削除されました.
  <% end -%>
  <hr>
<% end -%>

<h2 class="normal">人気の日記</h2>
<% @blog_data.each_with_index do |data, idx| -%>
  <div class="nice_rank"><%= idx + 1 %>位：<%= data[:count] %> イイネ</div>
  <% obj = Blog.find_by_id(data[:id]) -%>
  <% if obj.present? -%>
    <% if obj.blog_images.size > 0 -%>
      <% b_image = obj.blog_images.first -%>
      <%= image_tag(b_image.image(:thumb)) if b_image.image? %><br>
    <% end -%>
    日記：<%= link_to obj.title, blog_path(obj) %><br>
    <%= nice_author_and_created_at(obj) %>

    <div class="nice_user">
      イイネした人：
      <% obj.nices.each do |nice| -%>
        <%= nice.user.dispname %> /
      <% end -%>
    </div>
  <% else -%>
    削除されました.
  <% end -%>
  <hr>
<% end -%>

<h2 class="normal">人気の動画</h2>
<% @movie_data.each_with_index do |data, idx| -%>
  <div class="nice_rank"><%= idx + 1 %>位：<%= data[:count] %> イイネ</div>
  <% obj = Movie.find_by_id(data[:id]) -%>
  <% if obj.present? -%>
    動画：<%= link_to obj.title, movie_path(obj) %><br>
    <%= image_tag(obj.thumb(:thumb)) + '<br>' if obj.thumb?  %>
    <%= nice_author_and_created_at(obj) %>

    <div class="nice_user">
      イイネした人：
      <% obj.nices.each do |nice| -%>
        <%= nice.user.dispname %> /
      <% end -%>
    </div>
  <% else -%>
    削除されました.
  <% end -%>
  <hr>
<% end -%>


</div> <!-- #nice_show -->
